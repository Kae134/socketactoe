{"version":3,"sources":["../../../../../packages/vite/src/utils/ensure-dependencies.ts"],"sourcesContent":["import {\n  addDependenciesToPackageJson,\n  logger,\n  type GeneratorCallback,\n  type Tree,\n} from '@nx/devkit';\nimport {\n  edgeRuntimeVmVersion,\n  happyDomVersion,\n  jsdomVersion,\n  vitePluginDtsVersion,\n  vitePluginReactSwcVersion,\n  vitePluginReactVersion,\n} from './versions';\n\nexport type EnsureDependenciesOptions = {\n  uiFramework: 'react' | 'none';\n  compiler?: 'babel' | 'swc';\n  includeLib?: boolean;\n  testEnvironment?: 'node' | 'jsdom' | 'happy-dom' | 'edge-runtime' | string;\n};\n\nexport function ensureDependencies(\n  host: Tree,\n  schema: EnsureDependenciesOptions\n): GeneratorCallback {\n  const devDependencies: Record<string, string> = {};\n\n  if (schema.testEnvironment === 'jsdom') {\n    devDependencies['jsdom'] = jsdomVersion;\n  } else if (schema.testEnvironment === 'happy-dom') {\n    devDependencies['happy-dom'] = happyDomVersion;\n  } else if (schema.testEnvironment === 'edge-runtime') {\n    devDependencies['@edge-runtime/vm'] = edgeRuntimeVmVersion;\n  } else if (schema.testEnvironment !== 'node' && schema.testEnvironment) {\n    logger.info(\n      `A custom environment was provided: ${schema.testEnvironment}. You need to install it manually.`\n    );\n  }\n\n  if (schema.uiFramework === 'react') {\n    if (schema.compiler === 'swc') {\n      devDependencies['@vitejs/plugin-react-swc'] = vitePluginReactSwcVersion;\n    } else {\n      devDependencies['@vitejs/plugin-react'] = vitePluginReactVersion;\n    }\n  }\n\n  if (schema.includeLib) {\n    devDependencies['vite-plugin-dts'] = vitePluginDtsVersion;\n  }\n\n  return addDependenciesToPackageJson(host, {}, devDependencies);\n}\n"],"names":["ensureDependencies","host","schema","devDependencies","testEnvironment","jsdomVersion","happyDomVersion","edgeRuntimeVmVersion","logger","info","uiFramework","compiler","vitePluginReactSwcVersion","vitePluginReactVersion","includeLib","vitePluginDtsVersion","addDependenciesToPackageJson"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";+BAsBgBA;;;eAAAA;;;wBAjBT;0BAQA;AASA,SAASA,mBACdC,IAAU,EACVC,MAAiC;IAEjC,MAAMC,kBAA0C,CAAC;IAEjD,IAAID,OAAOE,eAAe,KAAK,SAAS;QACtCD,eAAe,CAAC,QAAQ,GAAGE,sBAAY;IACzC,OAAO,IAAIH,OAAOE,eAAe,KAAK,aAAa;QACjDD,eAAe,CAAC,YAAY,GAAGG,yBAAe;IAChD,OAAO,IAAIJ,OAAOE,eAAe,KAAK,gBAAgB;QACpDD,eAAe,CAAC,mBAAmB,GAAGI,8BAAoB;IAC5D,OAAO,IAAIL,OAAOE,eAAe,KAAK,UAAUF,OAAOE,eAAe,EAAE;QACtEI,cAAM,CAACC,IAAI,CACT,CAAC,mCAAmC,EAAEP,OAAOE,eAAe,CAAC,kCAAkC,CAAC;IAEpG;IAEA,IAAIF,OAAOQ,WAAW,KAAK,SAAS;QAClC,IAAIR,OAAOS,QAAQ,KAAK,OAAO;YAC7BR,eAAe,CAAC,2BAA2B,GAAGS,mCAAyB;QACzE,OAAO;YACLT,eAAe,CAAC,uBAAuB,GAAGU,gCAAsB;QAClE;IACF;IAEA,IAAIX,OAAOY,UAAU,EAAE;QACrBX,eAAe,CAAC,kBAAkB,GAAGY,8BAAoB;IAC3D;IAEA,OAAOC,IAAAA,oCAA4B,EAACf,MAAM,CAAC,GAAGE;AAChD"}