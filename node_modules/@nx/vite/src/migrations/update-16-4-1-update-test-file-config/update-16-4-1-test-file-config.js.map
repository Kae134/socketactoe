{"version":3,"sources":["../../../../../../packages/vite/src/migrations/update-16-4-1-update-test-file-config/update-16-4-1-test-file-config.ts"],"sourcesContent":["import { Tree, getProjects, updateProjectConfiguration } from '@nx/devkit';\nimport { forEachExecutorOptions } from '@nx/devkit/src/generators/executor-options-utils';\nimport { VitestExecutorOptions } from '../../executors/test/schema';\n\ntype OldVitestExecutorOptions = Omit<VitestExecutorOptions, 'testFiles'> & {\n  testFile: string;\n};\n\nexport default function update(tree: Tree) {\n  const projects = getProjects(tree);\n\n  forEachExecutorOptions<OldVitestExecutorOptions>(\n    tree,\n    '@nx/vite:test',\n    (options, projectName, targetName, configuration) => {\n      const projectConfig = projects.get(projectName);\n\n      if (!options.testFile) {\n        return;\n      }\n\n      const newTestFileArgs = [options.testFile];\n\n      delete options.testFile;\n\n      if (configuration) {\n        projectConfig.targets[targetName].configurations[configuration] = {\n          ...options,\n          testFiles: newTestFileArgs,\n        };\n      } else {\n        projectConfig.targets[targetName].options = {\n          ...options,\n          testFiles: newTestFileArgs,\n        };\n      }\n\n      updateProjectConfiguration(tree, projectName, projectConfig);\n    }\n  );\n}\n"],"names":["update","tree","projects","getProjects","forEachExecutorOptions","options","projectName","targetName","configuration","projectConfig","get","testFile","newTestFileArgs","targets","configurations","testFiles","updateProjectConfiguration"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";+BAQA;;;eAAwBA;;;;wBARsC;sCACvB;AAOxB,SAASA,OAAOC,IAAU;IACvC,MAAMC,WAAWC,IAAAA,mBAAW,EAACF;IAE7BG,IAAAA,4CAAsB,EACpBH,MACA,iBACA,CAACI,SAASC,aAAaC,YAAYC;QACjC,MAAMC,gBAAgBP,SAASQ,GAAG,CAACJ;QAEnC,IAAI,CAACD,QAAQM,QAAQ,EAAE;YACrB;QACF;QAEA,MAAMC,kBAAkB;YAACP,QAAQM,QAAQ;SAAC;QAE1C,OAAON,QAAQM,QAAQ;QAEvB,IAAIH,eAAe;YACjBC,cAAcI,OAAO,CAACN,WAAW,CAACO,cAAc,CAACN,cAAc,GAAG,eAC7DH;gBACHU,WAAWH;;QAEf,OAAO;YACLH,cAAcI,OAAO,CAACN,WAAW,CAACF,OAAO,GAAG,eACvCA;gBACHU,WAAWH;;QAEf;QAEAI,IAAAA,kCAA0B,EAACf,MAAMK,aAAaG;IAChD;AAEJ"}